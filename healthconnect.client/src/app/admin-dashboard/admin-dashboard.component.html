<div class="dashboard-container">
  <!-- Mobile Menu Toggle Button (Hamburger) -->
  <button class="mobile-menu-toggle" (click)="toggleMobileMenu()" [class.active]="showMobileMenu">
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
  </button>

  <!-- Mobile Menu Overlay -->
  <div class="mobile-menu-overlay" [class.active]="showMobileMenu" (click)="closeMobileMenu()"></div>

  <!-- Mobile Navigation Drawer -->
  <nav class="mobile-nav-drawer" [class.active]="showMobileMenu">
    <div class="mobile-nav-header">
      <h2>Menu</h2>
      <button class="mobile-nav-close" (click)="closeMobileMenu()">&times;</button>
    </div>

    <!-- Mobile Profile Section -->
    <div class="mobile-profile-section">
      <div class="mobile-user-avatar">{{ adminInitials }}</div>
      <div class="mobile-user-info">
        <h3>{{ admin?.fullName || 'Loading...' }}</h3>
        <p class="mobile-user-email">{{ admin?.email || 'Loading...' }}</p>
        <div class="mobile-user-details">
          <p><strong>Employee Number:</strong> {{ admin?.employeeNumber || 'N/A' }}</p>
          <p><strong>Role:</strong> {{ admin?.role || 'N/A' }}</p>
        </div>
      </div>
    </div>

    <!-- Mobile Menu Items -->
    <ul class="mobile-menu-list">
      <li *ngFor="let item of menuItems"
          [class.active]="item.checked"
          (click)="onMobileMenuItemClick(item)">
        <span class="mobile-menu-label">{{ item.label }}</span>
        <span class="mobile-menu-description">{{ item.description }}</span>
      </li>
    </ul>

    <!-- Mobile Logout Button -->
    <div class="mobile-logout-section">
      <button class="mobile-logout-btn" (click)="logout()">
        <span class="logout-icon">ðŸšª</span>
        <span class="logout-text">Logout</span>
      </button>
    </div>
  </nav>

  <!-- Top Header Bar -->
  <header class="top-bar">
    <div class="header-brand">
      <img class="header-logo" src="../../assets/logos/icononly_transparent_nobuffer.png" alt="Logo" />
      <div class="header-text">
        <h1>Madiba HealthConnect - Admin Portal</h1>
        <p class="header-subtitle">Managing Campus Healthcare</p>
      </div>
    </div>

    <!-- Desktop Header Avatar (hidden on mobile) -->
    <div class="header-avatar-container">
      <div class="header-avatar" (click)="toggleUserMenu()">
        {{ adminInitials }}
      </div>
      <div class="user-menu" *ngIf="showUserMenu">
        <div class="user-menu-item" (click)="logout()">
          <span class="menu-icon">ðŸšª</span>
          Logout
        </div>
      </div>
    </div>
  </header>

  <!-- Admin Profile Section -->
  <div class="profile-section">
    <div class="profile-container">
      <div class="user-avatar">
        {{ adminInitials }}
      </div>
      <div class="user-info">
        <h3>{{ admin?.fullName || 'Loading...' }}</h3>
        <p class="user-email">{{ admin?.email || 'Loading...' }}</p>
        <div class="user-details">
          <p><strong>Employee Number:</strong> {{ admin?.employeeNumber || 'N/A' }}</p>
          <p><strong>Role:</strong> {{ admin?.role || 'N/A' }}</p>
          <p><strong>Department:</strong> {{ admin?.department || 'N/A' }}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="dashboard-layout">
    <!-- Left Sidebar - Admin Navigation -->
    <aside class="sidebar">
      <nav class="main-nav">
        <ul>
          <li *ngFor="let item of menuItems"
              [class.active]="item.checked"
              (click)="onMenuItemClick(item)"
              [attr.data-section]="item.id">
            <label class="menu-item">
              <div class="menu-text">
                <span class="menu-label">{{ item.label }}</span>
                <span class="menu-description">{{ item.description }}</span>
              </div>
            </label>
          </li>
        </ul>

        <!-- Logout Button -->
        <div class="logout-section">
          <button class="logout-btn" (click)="logout()">
            <span class="logout-icon">ðŸšª</span>
            <span class="logout-text">Logout</span>
          </button>
        </div>
      </nav>

      <!-- Quick Stats -->
      <div class="quick-stats">
        <div class="stat-card">
          <div class="stat-number">{{ pendingAppointmentsCount }}</div>
          <div class="stat-label">Pending Assignments</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">{{ availableNursesCount }}/{{ totalNursesCount }}</div>
          <div class="stat-label">Nurses Available</div>
        </div>
      </div>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
      <!-- Dashboard Overview (Default View) -->
      <section id="overview-content" class="content-section" [class.hidden]="!isSectionActive('overview')">
        <div class="content-card">
          <div class="card-header">
            <h2>System Overview - {{ today | date:'fullDate' }}</h2>
          </div>
          <div class="card-content">
            <div class="overview-grid">
              <div class="overview-card">
                <h3>Appointments</h3>
                <div class="overview-number">{{ pendingAppointmentsCount + assignedAppointments.length }}</div>
                <p>Total appointments today</p>
              </div>
              <div class="overview-card">
                <h3>Nursing Staff</h3>
                <div class="overview-number">{{ totalNursesCount }}</div>
                <p>{{ availableNursesCount }} currently available</p>
              </div>
            </div>
          </div>
        </div>

        <div class="content-card">
          <div class="card-header">
            <h3>Recent Pending Appointments</h3>
          </div>
          <div class="card-content">
            <div class="appointment-list">
              <div *ngFor="let appointment of pendingAppointments.slice(0, 3)"
                   class="appointment-item">
                <div class="appointment-time">
                  <strong>{{ appointment.timeSlot }}</strong>
                </div>
                <div class="appointment-details">
                  <div class="patient-info">
                    <strong>{{ appointment.studentName }}</strong>
                    <span class="student-id">{{ appointment.studentNumber }}</span>
                  </div>
                  <div class="appointment-type">
                    {{ appointment.consultationType }}
                  </div>
                  <div class="symptoms">
                    {{ appointment.symptomsDescription }}
                  </div>
                </div>
                <div class="appointment-actions">
                  <button class="btn primary small"
                          (click)="assignAppointment(appointment)">
                    Assign Nurse
                  </button>
                </div>
              </div>
              <div *ngIf="pendingAppointments.length === 0" class="no-appointments">
                <p>No pending appointments requiring assignment.</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Appointment Management -->
      <section id="appointments-content" class="content-section" [class.hidden]="!isSectionActive('appointments')">
        <div class="content-card">
          <div class="card-header">
            <h2>Appointment Assignment</h2>
          </div>
          <div class="card-content">
            <!-- Pending Appointments -->
            <h3>Pending Assignment ({{ pendingAppointments.length }})</h3>
            <div class="appointment-list">
              <div *ngFor="let appointment of pendingAppointments" class="appointment-card">
                <!-- Appointment Info -->
                <div class="appointment-header">
                  <div class="appointment-time-badge">
                    <span class="time">{{ appointment.timeSlot }}</span>
                    <span class="date">{{ appointment.appointmentDate | date:'MMM d, y' }}</span>
                  </div>
                  <span class="status-badge pending">Pending</span>
                </div>

                <div class="appointment-body">
                  <div class="patient-section">
                    <h4>{{ appointment.studentName }}</h4>
                    <div class="patient-meta">
                      <span class="meta-item">
                        <strong>Student #:</strong> {{ appointment.studentNumber }}
                      </span>
                      <span class="meta-item">
                        <strong>Phone:</strong> {{ appointment.studentPhoneNumber }}
                      </span>
                    </div>
                    <div class="appointment-info">
                      <span class="info-badge">{{ appointment.consultationType }}</span>
                    </div>
                    <p class="symptoms">{{ appointment.symptomsDescription }}</p>
                  </div>

                  <!-- Inline Assignment Form -->
                  <div class="assignment-section" [class.expanded]="selectedAppointment?.id === appointment.id">
                    <div *ngIf="selectedAppointment?.id !== appointment.id">
                      <button class="btn primary" (click)="assignAppointment(appointment)">
                        Assign Nurse
                      </button>
                    </div>

                    <div *ngIf="selectedAppointment?.id === appointment.id" class="assignment-form">
                      <h4>Select Nurse for Assignment</h4>
                      <div class="form-group">
                        <label for="nurseSelect-{{appointment.id}}">Available Nurses</label>
                        <select id="nurseSelect-{{appointment.id}}"
                                [(ngModel)]="selectedNurseId"
                                class="form-control">
                          <option [value]="null" disabled>Choose a nurse...</option>
                          <option *ngFor="let nurse of getAvailableNurses()" [value]="nurse.id">
                            {{ nurse.fullName }} - {{ nurse.specialization }}
                          </option>
                        </select>
                      </div>
                      <div class="form-actions">
                        <button class="btn success"
                                (click)="confirmAssignment()"
                                [disabled]="!selectedNurseId">
                          Confirm Assignment
                        </button>
                        <button class="btn outline" (click)="cancelAssignment()">
                          Cancel
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div *ngIf="pendingAppointments.length === 0" class="no-appointments">
                <p>âœ… No appointments pending assignment.</p>
              </div>
            </div>

            <!-- Assigned Appointments -->
            <h3 style="margin-top: 2rem;">Assigned Appointments ({{ assignedAppointments.length }})</h3>
            <div class="appointment-list">
              <div *ngFor="let appointment of assignedAppointments" class="appointment-card assigned">
                <div class="appointment-header">
                  <div class="appointment-time-badge">
                    <span class="time">{{ appointment.timeSlot }}</span>
                    <span class="date">{{ appointment.appointmentDate | date:'MMM d, y' }}</span>
                  </div>
                  <span class="status-badge assigned">Assigned</span>
                </div>

                <div class="appointment-body">
                  <div class="patient-section">
                    <h4>{{ appointment.studentName }}</h4>
                    <div class="patient-meta">
                      <span class="meta-item">
                        <strong>Student #:</strong> {{ appointment.studentNumber }}
                      </span>
                      <span class="meta-item">
                        <strong>Phone:</strong> {{ appointment.studentPhoneNumber }}
                      </span>
                    </div>
                    <div class="appointment-info">
                      <span class="info-badge">{{ appointment.consultationType }}</span>
                      <span class="nurse-assigned">
                        <strong>Assigned to:</strong> {{ appointment.nurseName }}
                      </span>
                    </div>
                    <p class="symptoms">{{ appointment.symptomsDescription }}</p>
                  </div>
                </div>
              </div>

              <div *ngIf="assignedAppointments.length === 0" class="no-appointments">
                <p>No appointments have been assigned yet.</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Nurse Management -->
      <!-- Add this to your existing nurses section -->
      <section id="nurses-content" class="content-section" [class.hidden]="!isSectionActive('nurses')">
        <div class="content-card">
          <div class="card-header">
            <h2>Nurse Management</h2>
            <button class="btn primary" (click)="showCreateNurseForm()">Add New Nurse</button>
          </div>
          <div class="card-content">
            <!-- Nurse Creation Form -->
            <div *ngIf="showNurseForm" class="nurse-creation-form">
              <h3>Create New Nurse</h3>
              <form [formGroup]="nurseForm" (ngSubmit)="createNurse()">
                <div class="form-row">
                  <div class="form-group">
                    <label for="email">Email</label>
                    <input id="email" type="email" formControlName="email" placeholder="nurse@mandela.ac.za" required>
                    <div *ngIf="nurseForm.get('email')?.hasError('invalidAcademicEmail')" class="error-message">
                      Must be a Mandela University email address
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="password">Password</label>
                    <input id="password" type="password" formControlName="password" placeholder="Minimum 8 characters" required>
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="fullName">Full Name</label>
                    <input id="fullName" type="text" formControlName="fullName" placeholder="First Last" required>
                  </div>
                  <div class="form-group">
                    <label for="employeeNumber">Employee Number</label>
                    <input id="employeeNumber" type="text" formControlName="employeeNumber" placeholder="N123456" required>
                    <div *ngIf="nurseForm.get('employeeNumber')?.hasError('pattern')" class="error-message">
                      Must be in format N123456
                    </div>
                  </div>
                </div>
                <div class="form-row">
                  <!-- In the nurse form, ADD THIS after employeeNumber: -->
                  <div class="form-group">
                    <label for="phoneNumber">Phone Number</label>
                    <input type="tel"
                           id="phoneNumber"
                           formControlName="phoneNumber"
                           placeholder="0812345678"
                           required>
                    <span class="error-message"
                          *ngIf="nurseForm.get('phoneNumber')?.invalid && nurseForm.get('phoneNumber')?.touched">
                      Please enter a valid phone number (e.g., 0812345678)
                    </span>
                  </div>
                  <div class="form-group">
                    <label for="specialization">Specialization</label>
                    <select id="specialization" formControlName="specialization" required>
                      <option value="" disabled>Select specialization</option>
                      <option value="General Nursing">General Nursing</option>
                      <option value="Emergency Care">Emergency Care</option>
                      <option value="Primary Care">Primary Care</option>
                      <option value="Mental Health">Mental Health</option>
                      <option value="Pediatrics">Pediatrics</option>
                      <option value="Geriatrics">Geriatrics</option>
                    </select>
                  </div>
                </div>
                <div class="form-actions">
                  <button type="submit" class="btn primary" [disabled]="isCreatingNurse">
                    {{ isCreatingNurse ? 'Creating...' : 'Create Nurse' }}
                  </button>
                  <button type="button" class="btn outline" (click)="hideCreateNurseForm()">
                    Cancel
                  </button>
                </div>
              </form>
            </div>

            <!-- Existing Nurses List -->
            <div class="nurses-grid">
              <div *ngFor="let nurse of nurses" class="nurse-card">
                <div class="nurse-header">
                  <h3>{{ nurse.fullName }}</h3>
                  <span class="status-badge" [class.available]="nurse.isAvailable" [class.unavailable]="!nurse.isAvailable">
                    {{ nurse.isAvailable ? 'Available' : 'Unavailable' }}
                  </span>
                </div>
                <div class="nurse-details">
                  <p><strong>Employee #:</strong> {{ nurse.employeeNumber }}</p>
                  <p><strong>Specialization:</strong> {{ nurse.specialization }}</p>
                  <p><strong>Email:</strong> {{ nurse.email }}</p>
                  <p><strong>Tel:</strong> {{nurse.phoneNumber}}</p>
                </div>
                <div class="nurse-actions">
                  <label class="toggle">
                    <input type="checkbox" [checked]="nurse.isAvailable" (change)="toggleNurseAvailability(nurse)">
                    <span>Available for appointments</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Reports & Analytics -->
      <section id="reports-content" class="content-section" [class.hidden]="!isSectionActive('reports')">
        <div class="content-card">
          <div class="card-header">
            <h2>Reports & Analytics</h2>
          </div>
          <div class="card-content">
            <div class="reports-grid">
              <div class="report-card">
                <h3>Appointment Statistics</h3>
                <p>Comprehensive analytics on appointments, nurses, and clinic utilization</p>
                <button class="btn outline" (click)="viewAppointmentStatistics()">View Report</button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
</div>
