<div class="nurse-dashboard-container">
  <!-- Mobile Menu Toggle Button (Hamburger) -->
  <button class="mobile-menu-toggle" (click)="toggleMobileMenu()" [class.active]="showMobileMenu">
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
  </button>

  <!-- Mobile Menu Overlay -->
  <div class="mobile-menu-overlay" [class.active]="showMobileMenu" (click)="closeMobileMenu()"></div>

  <!-- Mobile Navigation Drawer -->
  <nav class="mobile-nav-drawer" [class.active]="showMobileMenu">
    <div class="mobile-nav-header">
      <h2>Menu</h2>
      <button class="mobile-nav-close" (click)="closeMobileMenu()">&times;</button>
    </div>

    <!-- Mobile Profile Section -->
    <div class="mobile-profile-section">
      <div class="mobile-user-avatar">{{ nurseInitials }}</div>
      <div class="mobile-user-info">
        <h3>{{ nurse?.fullName || 'Loading...' }}</h3>
        <p class="mobile-user-email">{{ nurse?.email || 'Loading...' }}</p>
        <div class="mobile-user-details">
          <p><strong>Employee Number:</strong> {{ nurse?.employeeNumber || 'N/A' }}</p>
          <p><strong>Specialization:</strong> {{ nurse?.specialization || 'N/A' }}</p>
        </div>
      </div>
    </div>

    <!-- Mobile Menu Items -->
    <ul class="mobile-menu-list">
      <li *ngFor="let item of menuItems"
          [class.active]="item.checked"
          (click)="onMobileMenuItemClick(item)">
        <span class="mobile-menu-label">{{ item.label }}</span>
        <span class="mobile-menu-description">{{ item.description }}</span>
      </li>
    </ul>

    <!-- Mobile Logout Button -->
    <div class="mobile-logout-section">
      <button class="mobile-logout-btn" (click)="logout()">
        <span class="logout-icon">ðŸšª</span>
        <span class="logout-text">Logout</span>
      </button>
    </div>
  </nav>

  <!-- Top Header Bar -->
  <header class="top-bar">
    <div class="header-brand">
      <img class="header-logo" src="../../assets/logos/icononly_transparent_nobuffer.png" alt="Logo" />
      <div class="header-text">
        <h1>Madiba HealthConnect - Nurse Portal</h1>
        <p class="header-subtitle">Providing Quality Healthcare</p>
      </div>
    </div>

    <!-- Desktop Header Avatar (hidden on mobile) -->
    <div class="header-avatar-container">
      <div class="header-avatar" (click)="toggleUserMenu()">
        {{ nurseInitials }}
      </div>
      <div class="user-menu" *ngIf="showUserMenu">
        <div class="user-menu-item" (click)="logout()">
          <span class="menu-icon">ðŸšª</span>
          Logout
        </div>
      </div>
    </div>
  </header>

  <!-- Nurse Profile Section -->
  <div class="profile-section">
    <div class="profile-container">
      <div class="user-avatar">
        {{ nurseInitials }}
      </div>
      <div class="user-info">
        <h3>{{ nurse?.fullName || 'Loading...' }}</h3>
        <p class="user-email">{{ nurse?.email || 'Loading...' }}</p>
        <div class="user-details">
          <p><strong>Employee Number:</strong> {{ nurse?.employeeNumber || 'N/A' }}</p>
          <p><strong>Specialization:</strong> {{ nurse?.specialization || 'N/A' }}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="dashboard-layout">
    <!-- Left Sidebar - Nurse Navigation -->
    <aside class="sidebar">
      <nav class="main-nav">
        <ul>
          <li *ngFor="let item of menuItems"
              [class.active]="item.checked"
              (click)="onMenuItemClick(item)"
              [attr.data-section]="item.id">
            <label class="menu-item">
              <div class="menu-text">
                <span class="menu-label">{{ item.label }}</span>
                <span class="menu-description">{{ item.description }}</span>
              </div>
            </label>
          </li>
        </ul>

        <!-- Logout Button -->
        <div class="logout-section">
          <button class="logout-btn" (click)="logout()">
            <span class="logout-icon">ðŸšª</span>
            <span class="logout-text">Logout</span>
          </button>
        </div>
      </nav>

      <!-- Quick Stats -->
      <div class="quick-stats">
        <div class="stat-card">
          <div class="stat-number">{{ appointments.length }}</div>
          <div class="stat-label">Total Appointments</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">{{ getAssignedAppointments().length }}</div>
          <div class="stat-label">Assigned</div>
        </div>
      </div>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
      <!-- Today's Schedule (Default View) -->
      <section id="schedule-content" class="content-section" [class.hidden]="!isSectionActive('schedule')">
        <div class="content-card">
          <div class="card-header">
            <h2>My Assigned Appointments</h2>
          </div>
          <div class="card-content">
            <div class="schedule-list">
              <div *ngFor="let appointment of appointments" class="appointment-card">
                <div class="appointment-header">
                  <h3>{{ appointment.studentName }}</h3>
                  <span class="status-badge" [class.assigned]="appointment.status === 'Assigned'"
                        [class.completed]="appointment.status === 'Completed'">
                    {{ appointment.status }}
                  </span>
                </div>
                <div class="appointment-info">
                  <p><strong>Student #:</strong> {{ appointment.studentNumber }}</p>
                  <p><strong>Phone:</strong> {{ appointment.studentPhoneNumber || 'N/A' }}</p>
                  <p><strong>Date:</strong> {{ appointment.appointmentDate | date:'mediumDate' }}</p>
                  <p><strong>Time:</strong> {{ appointment.timeSlot }}</p>
                  <p><strong>Type:</strong> {{ appointment.consultationType }}</p>
                  <p *ngIf="appointment.symptomsDescription"><strong>Symptoms:</strong> {{ appointment.symptomsDescription }}</p>
                </div>
              </div>

              <div *ngIf="appointments.length === 0" class="no-appointments">
                <p>No appointments assigned to you yet.</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- All Appointments View -->
      <section id="appointments-content" class="content-section" [class.hidden]="!isSectionActive('appointments')">
        <div class="content-card">
          <div class="card-header">
            <h2>My Appointments</h2>
          </div>
          <div class="card-content">
            <div class="appointment-list">
              <div *ngFor="let appointment of appointments" class="appointment-card">
                <div class="appointment-header">
                  <h3>{{ appointment.studentName }}</h3>
                  <span class="status-badge" [class.assigned]="appointment.status === 'Assigned'"
                        [class.completed]="appointment.status === 'Completed'">
                    {{ appointment.status }}
                  </span>
                </div>
                <div class="appointment-info">
                  <p><strong>Student #:</strong> {{ appointment.studentNumber }}</p>
                  <p><strong>Phone:</strong> {{ appointment.studentPhoneNumber || 'N/A' }}</p>
                  <p><strong>Date:</strong> {{ appointment.appointmentDate | date:'mediumDate' }}</p>
                  <p><strong>Time:</strong> {{ appointment.timeSlot }}</p>
                  <p><strong>Type:</strong> {{ appointment.consultationType }}</p>
                  <p *ngIf="appointment.symptomsDescription"><strong>Symptoms:</strong> {{ appointment.symptomsDescription }}</p>
                  <p *ngIf="appointment.notes"><strong>Notes:</strong> {{ appointment.notes }}</p>
                </div>
                <div class="appointment-actions">
                  <button *ngIf="appointment.status === 'Assigned'"
                          class="btn primary"
                          (click)="startConsultation(appointment)">
                    Start Consultation
                  </button>
                  <button *ngIf="appointment.status === 'Assigned'"
                          class="btn success"
                          (click)="updateAppointmentStatus(appointment.id, 'Completed')">
                    Mark Complete
                  </button>
                </div>
              </div>

              <div *ngIf="appointments.length === 0" class="no-appointments">
                <p>No appointments assigned to you yet.</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Consultation Notes View -->
      <section id="consultations-content" class="content-section" [class.hidden]="!isSectionActive('consultations')">
        <div class="content-card">
          <div class="card-header">
            <h2>Consultation Management</h2>
          </div>
          <div class="card-content">
            <div class="consultation-interface" *ngIf="activeConsultation">
              <h3>Consultation with {{ activeConsultation.studentName }}</h3>

              <div class="consultation-form">
                <div class="form-group">
                  <label for="consultationNotes">Consultation Notes</label>
                  <textarea id="consultationNotes"
                            [(ngModel)]="consultationNotes"
                            placeholder="Record observations, diagnosis, and treatment..."
                            rows="6"></textarea>
                </div>

                <div class="form-group">
                  <label for="prescription">Prescription (if any)</label>
                  <textarea id="prescription"
                            [(ngModel)]="prescription"
                            placeholder="Prescription details..."
                            rows="4"></textarea>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="toggle">
                      <input type="checkbox" [(ngModel)]="followUpRequired">
                      <span>Follow-up required</span>
                    </label>
                  </div>

                  <div class="form-group" *ngIf="followUpRequired">
                    <label for="followUpDate">Follow-up Date</label>
                    <input id="followUpDate" type="date" [(ngModel)]="followUpDate">
                  </div>
                </div>

                <div class="action-buttons">
                  <button class="btn success" (click)="saveConsultation()">
                    Save Consultation Notes
                  </button>
                  <button class="btn primary" (click)="completeConsultation(activeConsultation)">
                    Mark as Complete
                  </button>
                  <button class="btn outline" (click)="cancelConsultation()">
                    Cancel
                  </button>
                </div>
              </div>
            </div>

            <div *ngIf="!activeConsultation" class="no-consultation">
              <p>Select an appointment to start consultation.</p>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
</div>
