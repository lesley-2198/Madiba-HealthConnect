<div class="dashboard-container">

  <!-- Mobile Menu Toggle Button -->
  <button class="mobile-menu-toggle" (click)="toggleMobileMenu()" [class.active]="showMobileMenu">
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
  </button>

  <!-- Mobile Menu Overlay -->
  <div class="mobile-menu-overlay" [class.active]="showMobileMenu" (click)="closeMobileMenu()"></div>

  <!-- Mobile Navigation Drawer -->
  <nav class="mobile-nav-drawer" [class.active]="showMobileMenu">
    <div class="mobile-nav-header">
      <h2>Menu</h2>
      <button class="mobile-nav-close" (click)="closeMobileMenu()">
        <span>&times;</span>
      </button>
    </div>

    <div class="mobile-nav-profile">
      <div class="mobile-avatar">{{ userInitials }}</div>
      <div class="mobile-user-info">
        <h3>{{ user?.fullName || 'Loading...' }}</h3>
        <p>{{ user?.email || 'Loading...' }}</p>
      </div>
    </div>

    <ul class="mobile-nav-list">
      <li *ngFor="let item of menuItems"
          [class.active]="item.checked"
          (click)="onMobileMenuItemClick(item)">
        <span class="mobile-menu-label">{{ item.label }}</span>
        <span class="mobile-menu-badge"
              *ngIf="item.id === 'manual-booking' && hasActiveAppointments()">
          {{ appointments.length }}
        </span>
      </li>
    </ul>

    <div class="mobile-nav-footer">
      <button class="mobile-logout-btn" (click)="logout()">
        <span class="logout-icon">ðŸšª</span>
        <span>Logout</span>
      </button>
    </div>
  </nav>

  <!-- Top Header Bar -->
<header class="top-bar">
  <div class="header-brand">
    <img class="header-logo" src="../../assets/logos/icononly_transparent_nobuffer.png" alt="Logo" />
    <div class="header-text">
      <h1>Madiba HealthConnect</h1>
      <p class="header-subtitle">Campus Clinic Booking</p>
    </div>
  </div>

  <!-- Desktop Header Avatar (hidden on mobile) -->
  <div class="header-avatar-container">
    <div class="header-avatar" (click)="toggleUserMenu()">
      {{ userInitials }}
    </div>
    <div class="user-menu" *ngIf="showUserMenu">
      <div class="user-menu-item" (click)="logout()">
        <span class="menu-icon">ðŸšª</span>
        Logout
      </div>
    </div>
  </div>
</header>

  <!-- Profile Section -->
  <div class="profile-section">
    <div class="profile-container">
      <div class="user-avatar">
        {{ userInitials }}
      </div>
      <div class="user-info">
        <h3>{{ user?.fullName || 'Loading...' }}</h3>
        <p class="user-email">{{ user?.email || 'Loading...' }}</p>
        <div class="user-details">
          <p><strong>Student number:</strong> {{ user?.studentNumber || 'N/A' }}</p>
          <p><strong>Campus:</strong> {{ user?.campus || 'N/A' }}</p>
          <p><strong>Course:</strong> {{ user?.course || 'N/A' }}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="dashboard-layout">
    <!-- Left Sidebar -->
    <aside class="sidebar">
      <nav class="main-nav">
        <ul>
          <li *ngFor="let item of menuItems"
              [class.active]="item.checked"
              (click)="onMenuItemClick(item)"
              [attr.data-section]="item.id">
            <label class="menu-item">
              <div class="menu-text">
                <span class="menu-label">
                  {{ item.label }}
                  <!-- Badge for manual booking when appointments exist -->
                  <span class="appointment-badge"
                        *ngIf="item.id === 'manual-booking' && hasActiveAppointments()">
                    {{ appointments.length }}
                  </span>
                </span>
                <span class="menu-description">{{ item.description }}</span>
              </div>
            </label>
          </li>
        </ul>

        <!-- Updated Logout Button -->
        <div class="logout-section">
          <button class="logout-btn" (click)="logout()">
            <span class="logout-icon">ðŸšª</span>
            <span class="logout-text">Logout</span>
          </button>
        </div>
      </nav>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
      <!-- HealthConnect Content (Default) -->
      <section id="healthconnect-content" class="content-section" [class.hidden]="!isSectionActive('healthconnect')">
        <div class="content-card">
          <div class="card-header">
            <h2>HealthConnect</h2>
          </div>
          <div class="card-content">
            <p>
              Madiba HealthConnect is a platform committed to making healthcare accessible and convenient for all students and staff.
              Our clinic booking platform allows you to manually book a slot for in-person consultations or choose a tele-consultation
              with a professional nurse through triage booking. Whether you need routine care or urgent support, our system is designed
              to be user-friendly and efficient. We believe that everyone deserves timely and compassionate medical attention, and our
              platform is here to help you get the care you need, when you need it.
            </p>
          </div>
        </div>
      </section>

      <!-- Manual Booking Content -->
      <section id="manual-booking-content" class="content-section" [class.hidden]="!isSectionActive('manual-booking')">
        <div class="content-card">
          <div class="card-header">
            <h2>Manual Booking</h2>
          </div>
          <div class="card-content">
            <p>
              Easily schedule in-person appointments at our campus clinic through a simple booking system. Select time slots that
              fit your schedule, choose your campus, and specify your consultation type. You can also reschedule or cancel as
              needed - ensuring smooth clinic operations and minimal wait times.
            </p>
          </div>
        </div>
        <div class="content-card">
          <div class="card-content">
            <div class="tabs">
              <button class="tab-btn" [class.active]="activeBookingTab === 'book'" (click)="setBookingTab('book')">Book Appointment</button>
              <button class="tab-btn" [class.active]="activeBookingTab === 'manage'" (click)="setBookingTab('manage')">Manage Appointments</button>
            </div>

            <div class="tab-content" *ngIf="activeBookingTab === 'book'">
              <form class="booking-form" [formGroup]="bookingForm" (ngSubmit)="submitBooking()">
                <div class="form-row">
                  <div class="form-group">
                    <label for="appointmentDate">Date</label>
                    <input id="appointmentDate"
                           type="date"
                           formControlName="appointmentDate"
                           [min]="getMinDate()"
                           [max]="getMaxDate()"
                           (change)="onDateChange()"
                           required>
                    <div *ngIf="bookingForm.get('appointmentDate')?.hasError('weekendNotAllowed')"
                         class="error-message">
                      Appointments are not available on weekends. Please select a weekday.
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="timeSlot">Time Slot</label>
                    <select id="timeSlot" formControlName="timeSlot" class="form-control" required>
                      <option value="" disabled>Select a time slot</option>
                      <option *ngFor="let slot of availableTimeSlots" [value]="slot.value" [disabled]="!slot.available">
                        {{ slot.display }} <span *ngIf="!slot.available">(Unavailable)</span>
                      </option>
                    </select>
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="consultationType">Nurse Type</label>
                    <select id="consultationType" formControlName="consultationType" required>
                      <option value="" disabled>Select nurse specialization</option>
                      <option value="General Nursing">General Nursing</option>
                      <option value="Emergency Care">Emergency Care</option>
                      <option value="Primary Care">Primary Care</option>
                      <option value="Mental Health">Mental Health</option>
                      <option value="Pediatrics">Pediatrics</option>
                      <option value="Geriatrics">Geriatrics</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="symptomsDescription">Symptoms/Reason</label>
                    <input id="symptomsDescription" type="text" formControlName="symptomsDescription" placeholder="Describe your symptoms or reason for visit" required>
                  </div>
                </div>
                <div class="actions">
                  <button type="submit" class="btn primary" [disabled]="isSubmittingBooking">
                    {{ isSubmittingBooking ? 'Booking...' : 'Submit' }}
                  </button>
                </div>
              </form>
            </div>

            <div class="tab-content" *ngIf="activeBookingTab === 'manage'">
              <div class="appt-list" *ngIf="appointments.length; else noAppts">
                <div class="appt-item" *ngFor="let appt of appointments">
                  <div class="appt-info">
                    <div>
                      <strong>{{ appt.appointmentDate | date:'short' }} &#64; {{ appt.timeSlot }}</strong>
                    </div>
                    <div>Nurse Type: {{ appt.consultationType }} â€¢ Status: {{ appt.status }}</div>
                    <div>{{ appt.symptomsDescription }}</div>
                    <div *ngIf="appt.nurseName">Assigned to: {{ appt.nurseName }}</div>
                  </div>
                  <div class="appt-actions">
                    <button *ngIf="appt.status === 'Pending'" class="btn danger small" (click)="cancelAppointment(appt.id)">
                      Cancel
                    </button>
                    <button *ngIf="appt.status === 'Assigned'" class="btn outline small" (click)="rescheduleAppointment(appt.id)">
                      Reschedule
                    </button>
                  </div>
                </div>
              </div>
              <ng-template #noAppts>
                <p>No appointments yet.</p>
              </ng-template>
            </div>
          </div>
        </div>
      </section>

      <!-- Self-Care Tips Content -->
      <section id="self-care-content" class="content-section" [class.hidden]="!isSectionActive('self-care')">
        <div class="content-card">
          <div class="card-header">
            <h2>Self-Care Tips</h2>
          </div>
          <div class="card-content">
            <p>
              Many minor health issues can be managed at home. Here are some tips for common ailments.
              If symptoms persist or worsen, please book an appointment with our healthcare team.
            </p>
          </div>
        </div>
        <!-- Self-Care Tips Cards -->
        <div class="content-card">
          <div class="card-content">
            <div class="news-section-header">
              <h3>Common Ailments & Home Care</h3>
              <div class="news-controls" *ngIf="!isMobileView()">
                <button class="news-nav-btn prev" (click)="scrollNews(-1)" [disabled]="currentNewsIndex === 0">
                  â€¹
                </button>
                <span class="news-counter">{{ currentNewsIndex + 1 }} / {{ getTotalPages() }}</span>
                <button class="news-nav-btn next" (click)="scrollNews(1)" [disabled]="currentNewsIndex >= getTotalPages() - 1">
                  â€º
                </button>
              </div>
            </div>

            <div class="news-scroll-container">
              <div class="news-scroll-wrapper">
                <div class="news-scroll" [style.transform]="'translateX(' + translateX + 'px)'">
                  <div class="news-card" *ngFor="let tip of selfCareTips" [class.urgent]="tip.severity === 'urgent'">
                    <div class="tip-icon">{{ tip.icon }}</div>
                    <h4>{{ tip.title }}</h4>
                    <p>{{ tip.description }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
</div>
